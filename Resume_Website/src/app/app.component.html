<ng-container [ngSwitch]="theme">
  <app-bg-dark *ngSwitchCase="'dark'"></app-bg-dark>
  <app-bg-light *ngSwitchCase="'light'"></app-bg-light>
  <app-bg-lava *ngSwitchCase="'lava'"></app-bg-lava>
  <app-bg-constellation *ngSwitchCase="'constellation'"></app-bg-constellation>
</ng-container>

<!-- Sticky dots nav (matches header's sections only) -->
<nav class="dots-nav" [attr.aria-label]="ui.nav.dotsAria">
  <a [class.active]="activeSection==='about'"        (click)="scrollTo('#about')"        [attr.aria-label]="ui.nav.about"></a>
  <a [class.active]="activeSection==='experience'"   (click)="scrollTo('#experience')"   [attr.aria-label]="ui.nav.experience"></a>
  <a [class.active]="activeSection==='projects'"     (click)="scrollTo('#projects')"     [attr.aria-label]="ui.nav.projects"></a>
  <a [class.active]="activeSection==='testimonials'" (click)="scrollTo('#testimonials')" [attr.aria-label]="ui.nav.testimonials"></a>
</nav>

<!-- Back to top -->
<button class="to-top" (click)="scrollTo('body')" [attr.aria-label]="ui.nav.backToTop">↑</button>

<div class="container sticky-container">
  <app-header
    [activeSection]="activeSection"
    [currentTheme]="theme"
    (setTheme)="onTheme($event)"
    (toggleTheme)="toggleTheme()"
    (openPalette)="openPalette()"
    (navigate)="scrollTo($event)">
  </app-header>
</div>

<br>

<!-- Page content -->
<div class="container">
  <div class="page">

    <main class="main">
      <!-- Hero -->
      <section class="glass hero reveal" id="about" aria-label="About me">
        <div class="hero-content">
          <div class="badge pulse">{{ me.title }}</div>
          <br>
          <br>
          <h1>
            <span class="hi">{{ ui.hero.hi }}</span>
            <span class="name gradient-text">{{ me.name }}</span>
          </h1>
          <p class="subtitle">{{ ui.hero.subtitle }}</p>

          <div class="ctas">
            <a class="btn btn-primary magnetic"
               (mousemove)="magnetic($event)" (mouseleave)="unmagnetic($event)"
               [href]="ui.hero.cvPath" (click)="confetti($event)" download
               [attr.aria-label]="ui.hero.ctas.download">
              <span>{{ ui.hero.ctas.download }}</span>
              <span class="ripple" (mousedown)="ripple($event)"></span>
            </a>
            <a class="btn btn-ghost magnetic"
               (mousemove)="magnetic($event)" (mouseleave)="unmagnetic($event)"
               href="#contact" [attr.aria-label]="ui.hero.ctas.contact">
              {{ ui.hero.ctas.contact }}
              <span class="ripple" (mousedown)="ripple($event)"></span>
            </a>
          </div>

          <!-- Skills marquee -->
          <div class="marquee" aria-hidden="true">
            <div class="track">
              <span *ngFor="let s of marqueeSkills">{{ s }}</span>
            </div>
          </div>
        </div>
      </section>

      <!-- About -->
      <section class="glass section about reveal" aria-label="About details">
        <h2>{{ ui.about.heading }}</h2>
        <p class="lead">{{ ui.about.lead }}</p>
        <div class="chips">
          <button class="chip" *ngFor="let s of me.skills">{{ s }}</button>
        </div>
      </section>

      <!-- Experience -->
      <section id="experience" class="glass section reveal" aria-label="Experience timeline">
        <h2>{{ ui.experience.heading }}</h2>
        <div class="timeline">
          <article class="step tilt-card"
                  *ngFor="let e of experience; let i = index"
                  (click)="toggleStep(i)"
                  (mousemove)="tilt($event)" (mouseleave)="resetTilt($event)">
            <header>
              <div>
                <div class="role">{{ e.role }}</div>
                <div class="company">{{ e.company }}</div>
              </div>
              <div class="meta">
                <span class="badge">{{ e.year }}</span>
              </div>
            </header>
            <div class="content" [class.open]="openStep===i" [attr.aria-hidden]="openStep===i ? 'false':'true'">
              <p>{{ e.blurb }}</p>
            </div>
          </article>
        </div>
      </section>

      <!-- Projects -->
      <section id="projects" class="glass section reveal" aria-label="Projects">
        <h2>{{ ui.projects.heading }}</h2>

        <!-- Carousel -->
        <div class="projects-track" #projectsTrack role="listbox"
            (mousedown)="startDrag($event)" (mousemove)="onDrag($event)" (mouseleave)="endDrag()"
            (mouseup)="endDrag()" (wheel)="wheelScroll($event)" [attr.aria-label]="ui.projects.ariaCarousel">
          <article class="project tilt-card"
                  *ngFor="let p of projects" (mousemove)="tilt($event)" (mouseleave)="resetTilt($event)">
            <div class="project-head">
              <h3>{{ p.title }}</h3>
              <div class="badges">
                <span class="badge" *ngFor="let t of p.tags">{{ t }}</span>
              </div>
            </div>
            <p>{{ p.desc }}</p>
              <a [href]="p.link" class="link"
                target="_blank" rel="noopener noreferrer"
                [attr.aria-label]="'Read more about ' + p.title">
                {{ ui.projects.readMoreText }}
              </a>
          </article>
        </div>
      </section>

      <!-- Testimonials (optional) -->
      <!--
      <section id="testimonials" class="glass section reveal" aria-label="Testimonials">
        <h2>{{ ui.testimonials.heading }}</h2>
        <div class="quotes">
          <figure class="quote tilt-card" *ngFor="let q of testimonials"
                  (mousemove)="tilt($event)" (mouseleave)="resetTilt($event)">
            <blockquote>{{ q.quote }}</blockquote>
            <figcaption>— {{ q.by }}</figcaption>
          </figure>
        </div>
      </section>
      -->

      <!-- Contact (kept on page; not tracked by header) -->
      <section id="contact" class="glass section reveal" aria-label="Contact">
        <h2>{{ ui.contact.heading }}</h2>
        <div class="contact-grid">
          <div>
            <p>{{ ui.contact.lead }}</p>
            <div class="contact-actions">
              <button class="btn" (click)="copy(me.email, $event)" [attr.aria-label]="ui.contact.actions.copyEmailAria">
                {{ me.email }}
                <span class="ripple" (mousedown)="ripple($event)"></span>
              </button>
            </div>
          </div>

          <!-- Contact form wired to POST /api/contact -->
          <form class="contact-form"
                (ngSubmit)="submitContact()"
                #contactForm="ngForm"
                novalidate
                aria-label="Quick message">

            <label>
              <span>{{ ui.contact.form.name }}</span>
              <input type="text"
                     required
                     name="name"
                     [(ngModel)]="contact.name"
                     [placeholder]="ui.contact.form.placeholderName">
            </label>

            <label>
              <span>{{ ui.contact.form.email }}</span>
              <input type="email"
                     required
                     name="email"
                     [(ngModel)]="contact.email"
                     [placeholder]="ui.contact.form.placeholderEmail">
            </label>

            <label class="full">
              <span>{{ ui.contact.form.message }}</span>
              <textarea rows="4"
                        required
                        name="message"
                        [(ngModel)]="contact.message"
                        [placeholder]="ui.contact.form.placeholderMsg"></textarea>
            </label>

            <button class="btn btn-primary"
                    type="submit"
                    [disabled]="contactLoading || !contactForm.form.valid">
              <ng-container *ngIf="!contactLoading; else sending">
                {{ ui.contact.form.submit }}
              </ng-container>
              <ng-template #sending>Sending…</ng-template>
              <span class="ripple" (mousedown)="ripple($event)"></span>
            </button>

            <!-- lightweight feedback -->
            <p class="form-msg success" *ngIf="contactSuccess">Thanks—your message was sent.</p>
            <p class="form-msg error" *ngIf="contactError">{{ contactError }}</p>
          </form>
        </div>
      </section>

      <footer class="footer">
        <p>© {{year}} {{ ui.footer.copyrightHolder }} — {{ ui.footer.rights }}</p>
      </footer>
    </main>
  </div>
</div>

<!-- Command Palette -->
<div class="palette-backdrop" [class.open]="paletteOpen" (click)="closePalette()"></div>
<div class="palette" [class.open]="paletteOpen" role="dialog" aria-modal="true" aria-label="Command palette">
  <input #paletteInput type="text" class="palette-input" [placeholder]="ui.palette.placeholder"
         [(ngModel)]="paletteQuery" (keydown)="paletteKey($event)">
  <ul class="palette-list">
    <li *ngFor="let cmd of filteredCommands(); let i = index"
        [class.active]="i===paletteIndex"
        (click)="runCommand(cmd)">
      <span class="k">{{cmd.k}}</span>
      <span class="t">{{cmd.t}}</span>
      <span class="h">{{cmd.h}}</span>
    </li>
  </ul>
  <div class="palette-hint">{{ ui.palette.hint }}</div>
</div>
